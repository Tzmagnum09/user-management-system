{% extends 'base.html.twig' %}

{% block title %}{{ 'Register'|trans }} - {{ parent() }}{% endblock %}

{% block page_stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/auth.css') }}">
{% endblock %}

{% block navbar %}
<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
        <a class="navbar-brand" href="{{ path('app_home') }}">
            <img src="{{ asset('images/logo.png') }}" height="30" alt="Dmqode.be">
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="{{ path('app_home') }}">{{ 'Accueil'|trans }}</a>
                </li>
            </ul>
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link" href="{{ path('app_login') }}">
                        <i class="fas fa-sign-in-alt"></i> {{ 'Connexion'|trans }}
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="{{ path('app_register') }}">
                        <i class="fas fa-user-plus"></i> {{ 'Inscription'|trans }}
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="languageDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-globe"></i> {{ app.request.locale|upper }}
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown">
                        {% set locales = app_supported_locales|split(',') %}
                        {% for locale in locales %}
                            <li><a class="dropdown-item {% if app.request.locale == locale %}active{% endif %}" href="{{ path(app.request.attributes.get('_route'), app.request.attributes.get('_route_params')|merge({_locale: locale})) }}">{{ locale|upper }}</a></li>
                        {% endfor %}
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>
{% endblock %}

{% block body %}
<div class="container">
    <div class="auth-container register-container">
        <div class="auth-header">
            <h5 class="m-0">{{ 'Créez votre compte'|trans }}</h5>
        </div>
        
        <div class="auth-content">
            {{ form_start(registrationForm) }}
                <div class="form-row">
                    <div class="form-col">
                        <label class="form-label">{{ 'Adresse e-mail'|trans }}</label>
                        {{ form_widget(registrationForm.email, {
                            'attr': {
                                'class': 'form-control',
                                'placeholder': 'exemple@domaine.com'
                            }
                        }) }}
                    </div>
                    <div class="form-col">
                        <label class="form-label">{{ 'Nom d\'utilisateur'|trans }}</label>
                        {{ form_widget(registrationForm.username, {
                            'attr': {
                                'class': 'form-control',
                                'placeholder': 'votre pseudo'
                            }
                        }) }}
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label class="form-label">{{ 'Prénom'|trans }}</label>
                        {{ form_widget(registrationForm.firstName, {
                            'attr': {
                                'class': 'form-control',
                                'placeholder': 'Votre prénom'
                            }
                        }) }}
                    </div>
                    <div class="form-col">
                        <label class="form-label">{{ 'Nom'|trans }}</label>
                        {{ form_widget(registrationForm.lastName, {
                            'attr': {
                                'class': 'form-control',
                                'placeholder': 'Votre nom'
                            }
                        }) }}
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label class="form-label">{{ 'Date de naissance'|trans }}</label>
                        {{ form_widget(registrationForm.birthDate, {
                            'attr': {
                                'class': 'form-control'
                            }
                        }) }}
                    </div>
                    <div class="form-col">
                        <label class="form-label">{{ 'Numéro de téléphone'|trans }}</label>
                        {{ form_widget(registrationForm.phoneNumber, {
                            'attr': {
                                'class': 'form-control',
                                'placeholder': '+32 470 12 34 56'
                            }
                        }) }}
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label class="form-label">{{ 'Rue'|trans }}</label>
                        {{ form_widget(registrationForm.street, {
                            'attr': {
                                'class': 'form-control',
                                'placeholder': 'Nom de la rue'
                            }
                        }) }}
                    </div>
                    <div class="form-col">
                        <label class="form-label">{{ 'Numéro'|trans }}</label>
                        {{ form_widget(registrationForm.houseNumber, {
                            'attr': {
                                'class': 'form-control',
                                'placeholder': '123'
                            }
                        }) }}
                    </div>
                    <div class="form-col">
                        <label class="form-label">{{ 'Boîte'|trans }}</label>
                        {{ form_widget(registrationForm.boxNumber, {
                            'attr': {
                                'class': 'form-control',
                                'placeholder': 'A'
                            }
                        }) }}
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label class="form-label">{{ 'Code postal'|trans }}</label>
                        {{ form_widget(registrationForm.postalCode, {
                            'attr': {
                                'class': 'form-control',
                                'placeholder': '1000'
                            }
                        }) }}
                    </div>
                    <div class="form-col">
                        <label class="form-label">{{ 'Ville'|trans }}</label>
                        {{ form_widget(registrationForm.city, {
                            'attr': {
                                'class': 'form-control',
                                'placeholder': 'Bruxelles'
                            }
                        }) }}
                    </div>
                    <div class="form-col">
                        <label class="form-label">{{ 'Pays'|trans }}</label>
                        {{ form_widget(registrationForm.country, {
                            'attr': {
                                'class': 'form-select'
                            }
                        }) }}
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">{{ 'Langue'|trans }}</label>
                    {{ form_widget(registrationForm.locale, {
                        'attr': {
                            'class': 'form-select'
                        }
                    }) }}
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <label class="form-label">{{ 'Mot de passe'|trans }}</label>
                        {{ form_widget(registrationForm.plainPassword.first, {
                            'attr': {
                                'class': 'form-control',
                                'placeholder': '8 caractères minimum'
                            }
                        }) }}
                    </div>
                    <div class="form-col">
                        <label class="form-label">{{ 'Confirmer le mot de passe'|trans }}</label>
                        {{ form_widget(registrationForm.plainPassword.second, {
                            'attr': {
                                'class': 'form-control',
                                'placeholder': 'Répétez votre mot de passe'
                            }
                        }) }}
                    </div>
                </div>
                
                <div class="form-check">
                    {{ form_widget(registrationForm.agreeTerms, {
                        'attr': {
                            'class': 'form-check-input'
                        }
                    }) }}
                    <label class="form-check-label" for="{{ registrationForm.agreeTerms.vars.id }}">
                        {{ "J'accepte les conditions d'utilisation"|trans }}
                        <a href="{{ path('app_terms') }}" class="terms-link">{{ "Conditions d'utilisation"|trans }}</a>
                    </label>
                </div>
                
                <div class="validation-message">
                    <i class="fas fa-info-circle"></i>
                    {{ "Après votre inscription, vous devrez vérifier votre adresse e-mail. Ensuite, un administrateur devra approuver votre compte."|trans }}
                </div>
                
                <button type="submit" class="btn-register">{{ 'S\'inscrire'|trans }}</button>
            {{ form_end(registrationForm) }}
            
            <div class="login-link">
                {{ "Vous avez déjà un compte?"|trans }} <a href="{{ path('app_login') }}">{{ "Connectez-vous"|trans }}</a>
            </div>
        </div>
    </div>
</div>

<!-- Modal des conditions d'utilisation -->
<div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #8e44ad, #3498db); color: white;">
                <h5 class="modal-title" id="termsModalLabel">{{ 'Conditions d\'utilisation'|trans }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(1) brightness(200%);"></button>
            </div>
            <div class="modal-body">
                <div class="terms-section mb-4">
                    <h4>1. Introduction</h4>
                    <p>Bienvenue sur DMQode.be. Les présentes conditions d'utilisation régissent votre utilisation de notre site web et de nos services. En vous inscrivant sur notre site, vous acceptez d'être lié par ces conditions. Veuillez les lire attentivement.</p>
                </div>
                
                <div class="terms-section mb-4">
                    <h4>2. Définitions</h4>
                    <ul>
                        <li><strong>'Service'</strong> désigne le site web DMQode.be</li>
                        <li><strong>'Utilisateur'</strong> désigne toute personne qui accède au Service et crée un compte</li>
                        <li><strong>'Compte'</strong> désigne l'accès personnalisé au Service</li>
                    </ul>
                </div>
                
                <div class="terms-section mb-4">
                    <h4>3. Inscription et compte</h4>
                    <p>Pour utiliser certaines fonctionnalités du Service, vous devez créer un compte. Lors de l'inscription, vous acceptez de fournir des informations exactes, à jour et complètes. Vous êtes responsable de la confidentialité de votre mot de passe et de toutes les activités qui se produisent sous votre compte.</p>
                    <p>Après votre inscription, vous devrez vérifier votre adresse e-mail. Ensuite, un administrateur devra approuver votre compte avant que vous puissiez accéder à toutes les fonctionnalités du service.</p>
                </div>
                
                <div class="terms-section mb-4">
                    <h4>4. Droits et responsabilités</h4>
                    <p>En utilisant notre Service, vous acceptez de ne pas :</p>
                    <ul>
                        <li>Violer les lois applicables</li>
                        <li>Distribuer des virus ou tout autre code malveillant</li>
                        <li>Perturber ou interférer avec la sécurité du Service</li>
                        <li>Recueillir des informations sur d'autres utilisateurs sans leur consentement</li>
                        <li>Utiliser le Service d'une manière qui pourrait endommager, désactiver, surcharger ou altérer le Service</li>
                    </ul>
                </div>
                
                <div class="terms-section mb-4">
                    <h4>5. Protection des données personnelles</h4>
                    <p>Nous respectons votre vie privée et protégeons vos données personnelles conformément à notre politique de confidentialité et aux lois applicables, notamment le Règlement Général sur la Protection des Données (RGPD).</p>
                    <p>Les données personnelles que vous nous fournissez lors de l'inscription sont utilisées uniquement dans le cadre de la fourniture de nos services et ne seront pas partagées avec des tiers sans votre consentement explicite.</p>
                </div>
                
                <div class="terms-section mb-4">
                    <h4>6. Modification des conditions d'utilisation</h4>
                    <p>Nous nous réservons le droit de modifier ces conditions d'utilisation à tout moment. Les modifications entrent en vigueur dès leur publication sur le Service. Il est de votre responsabilité de consulter régulièrement ces conditions.</p>
                </div>
                
                <div class="terms-section mb-4">
                    <h4>7. Résiliation</h4>
                    <p>Nous nous réservons le droit de suspendre ou de résilier votre compte et votre accès au Service à notre seule discrétion, sans préavis, pour conduite que nous jugeons contraire à ces conditions d'utilisation ou à toute loi applicable.</p>
                </div>
                
                <div class="terms-section mb-4">
                    <h4>8. Contact</h4>
                    <p>Si vous avez des questions concernant ces conditions d'utilisation, veuillez nous contacter à l'adresse suivante : <a href="mailto:contact@dmqode.be">contact@dmqode.be</a></p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ 'Fermer'|trans }}</button>
                <button type="button" class="btn btn-primary" id="acceptTerms" data-bs-dismiss="modal">{{ 'J\'accepte'|trans }}</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block footer %}
<footer class="footer mt-5">
    <div class="container text-center">
        <p>&copy; {{ 'now'|date('Y') }} {{ app_name }}. {{ 'Tous droits réservés.'|trans }}</p>
    </div>
</footer>
{% endblock %}

{% block page_javascripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Liens des conditions d'utilisation
        const termsLinks = document.querySelectorAll('.terms-link');
        const termsModal = document.getElementById('termsModal');
        const agreeTermsCheckbox = document.getElementById('{{ registrationForm.agreeTerms.vars.id }}');
        const acceptTermsButton = document.getElementById('acceptTerms');
        
        // Initialiser la modal Bootstrap
        const bsModal = new bootstrap.Modal(termsModal);
        
        // Intercepter les liens des conditions pour ouvrir la modal
        termsLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                bsModal.show();
            });
        });
        
        // Cocher la case lorsque l'utilisateur accepte les conditions
        if (acceptTermsButton && agreeTermsCheckbox) {
            acceptTermsButton.addEventListener('click', function() {
                agreeTermsCheckbox.checked = true;
            });
        }
    });
</script>
{% endblock %}